<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Earthquake Magnitudes: Seismic Moment, Moment Magnitude and Local Magnitude &mdash; BPMF 2.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Updates" href="../../updates.html" />
    <link rel="prev" title="Build Earthquake Catalog" href="9_build_earthquake_catalog.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            BPMF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../general.html">Pre-requisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="0_initialize_project.html">Project Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="1_download_data.html">Download Seismic Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_preprocess_data.html">Preprocess Seismic Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_network_file.html">Make Network File</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_travel_times.html">Compute P-/S-wave travel Times</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_backprojection.html">Backprojection of the Seismic Wavefield</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_relocate.html">Relocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="7_build_template_database.html">Build Template Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="8_template_matching.html">Template Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="9_build_earthquake_catalog.html">Build Earthquake Catalog</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Earthquake Magnitudes: Seismic Moment, Moment Magnitude and Local Magnitude</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Moment-Magnitude-M_w">Moment Magnitude <span class="math notranslate nohighlight">\(M_w\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Local-Magnitude-M_L">Local Magnitude <span class="math notranslate nohighlight">\(M_L\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="#References">References</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Load-the-metadata-of-the-previously-detected-events">Load the metadata of the previously detected events</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Example-with-a-single-event">Example with a single event</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Repeat-the-same-processing-for-every-event">Repeat the same processing for every event</a></li>
<li class="toctree-l3"><a class="reference internal" href="#To-be-continued…">To be continued…</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../updates.html">Updates</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BPMF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../tutorial.html">Tutorial</a></li>
      <li class="breadcrumb-item active">Earthquake Magnitudes: Seismic Moment, Moment Magnitude and Local Magnitude</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorial/notebooks/10_magnitudes.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Earthquake-Magnitudes:-Seismic-Moment,-Moment-Magnitude-and-Local-Magnitude">
<h1>Earthquake Magnitudes: Seismic Moment, Moment Magnitude and Local Magnitude<a class="headerlink" href="#Earthquake-Magnitudes:-Seismic-Moment,-Moment-Magnitude-and-Local-Magnitude" title="Permalink to this heading"></a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this heading"></a></h2>
<p>There exist several magnitude scales that measure the size of an earthquake. The local magnitude <span class="math notranslate nohighlight">\(M_L\)</span>, or Richter’s magnitude, is often used for small events because it is easy to calculate (however, uncertainties are often large!). The moment magnitude <span class="math notranslate nohighlight">\(M_w\)</span> is the only magnitude that relates unambiguously to some physical earthquake parameter, the seismic moment <span class="math notranslate nohighlight">\(M_0\)</span>. Estimating the moment magnitude <span class="math notranslate nohighlight">\(M_w\)</span> requires to observe the low-frequency part of the radiated
waveform spectrum, which is often challenging for small events for which low frequencies are under the noise level. In this notebook, we will see how to use tools from the <code class="docutils literal notranslate"><span class="pre">BPMF.spectrum</span></code> module to estimate moment and local magnitudes.</p>
</section>
<section id="Moment-Magnitude-M_w">
<h2>Moment Magnitude <span class="math notranslate nohighlight">\(M_w\)</span><a class="headerlink" href="#Moment-Magnitude-M_w" title="Permalink to this heading"></a></h2>
<p>For events that were accurately relocated (<span class="math notranslate nohighlight">\(h_{max,unc} &lt; 5\)</span> km) with <code class="docutils literal notranslate"><span class="pre">NonLinLoc</span></code>, we can try to estimate their seismic moment <span class="math notranslate nohighlight">\(M_0\)</span> and moment magnitude <span class="math notranslate nohighlight">\(M_w\)</span> by fitting their network-averaged, path-corrected displacement spectrum with the omega-square model (Brune or Boatwright model).</p>
<p>We recall that (note that <span class="math notranslate nohighlight">\(\log\)</span> is the base 10 logarithm):</p>
<div class="math notranslate nohighlight">
\[M_w = \frac{2}{3} \left( \log M_0 - 9.1 \right)\quad (1),\]</div>
<p>with <span class="math notranslate nohighlight">\(M_0\)</span> in N.m.</p>
<p>Models of displacement spectra in the far-field predict the shape:</p>
<div class="math notranslate nohighlight">
\[S(f) = \dfrac{\Omega_0}{\left( 1 + (f/f_c)^{\gamma n} \right)^{1/\gamma}}\quad (2).\]</div>
<p>Equation (2) is a general expression where <span class="math notranslate nohighlight">\(f_c\)</span> is the corner frequency and <span class="math notranslate nohighlight">\(n\)</span> controls the high-frequency fall-off rate of the spectrum (typically <span class="math notranslate nohighlight">\(n \approx 2\)</span>) and <span class="math notranslate nohighlight">\(\gamma\)</span> controls the sharpness of the spectrum’s corner. Two special cases of (2) are: - The Brune spectrum (<span class="math notranslate nohighlight">\(n=2\)</span>, <span class="math notranslate nohighlight">\(\gamma = 1\)</span>):</p>
<div class="math notranslate nohighlight">
\[S_{\mathrm{Brune}}(f) = \dfrac{\Omega_0}{1 + (f/f_c)^{2}}\quad (3)\]</div>
<ul class="simple">
<li><p>Boatwright’s spectrum (<span class="math notranslate nohighlight">\(n=2\)</span>, <span class="math notranslate nohighlight">\(\gamma=2\)</span>):</p></li>
</ul>
<div class="math notranslate nohighlight">
\[S_{\mathrm{Boatwright}}(f) = \dfrac{\Omega_0}{\left( 1 + (f/f_c)^{2 n} \right)^{1/2}}\quad (4)\]</div>
<p>The low-frequency plateau <span class="math notranslate nohighlight">\(\Omega_0\)</span> is proportional to the seismic moment <span class="math notranslate nohighlight">\(M_0\)</span>.</p>
<div class="math notranslate nohighlight">
\[\Omega^{P/S}_0 = \dfrac{M_0 R^{P/S}}{4 \pi \sqrt{\rho(\xi) \rho(x) v_{P/S}(\xi) v_{P/S}(x) } v_{P/S}^2(\xi) \mathcal{R}_{P/S}(x, \xi)} \exp \left( - \dfrac{\pi \tau^{P/S}(x, \xi) f}{Q^{P/S}} \right)\quad (5).\]</div>
<p>In Equation (5), the P/S superscript is for P and S wave, <span class="math notranslate nohighlight">\(x\)</span> is the receiver location and <span class="math notranslate nohighlight">\(\xi\)</span> is the source location. <span class="math notranslate nohighlight">\(R^{P/S}\)</span> is the average radiation pattern (<span class="math notranslate nohighlight">\(R^P = \sqrt{4/15}\)</span> and <span class="math notranslate nohighlight">\(R^S = \sqrt{2/5}\)</span>, see Aki and Richards, 2002), <span class="math notranslate nohighlight">\(\rho\)</span> and <span class="math notranslate nohighlight">\(v_{P/S}\)</span> are the medium density and P/S-wave velocity at the source, respectively, <span class="math notranslate nohighlight">\(\mathcal{R}_{P/S}(x, \xi)\)</span> is the P/S ray length (which can be approximated by <span class="math notranslate nohighlight">\(r\)</span>, the source-receiver
distance), <span class="math notranslate nohighlight">\(\tau^{P/S}(x, \xi)\)</span> is the P/S travel time and <span class="math notranslate nohighlight">\(Q^{P/S}\)</span> is the P/S attenuation factor. More details in Aki and Richards, 2002 and Boatwright, 1978.</p>
</section>
<section id="Local-Magnitude-M_L">
<h2>Local Magnitude <span class="math notranslate nohighlight">\(M_L\)</span><a class="headerlink" href="#Local-Magnitude-M_L" title="Permalink to this heading"></a></h2>
<p>The local magnitude was initially introduced by Richter as the log ratio of peak displacement amplitudes between two earthquakes:</p>
<div class="math notranslate nohighlight">
\[M_L = \log \left( \dfrac{A(X)}{A_0(X)} \right),\quad (6)\]</div>
<p>which results in an empirical formula correcting for the source-receiver epicentral distance <span class="math notranslate nohighlight">\(X\)</span>:</p>
<div class="math notranslate nohighlight">
\[M_L = \log A(X) + \alpha \log X + \beta,\quad (7)\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> and region-specific parameters (see Peter Shearer’s Introduction to Seismology book, Equations 9.68 and 9.69).</p>
<p>In this notebook, we define the local magnitude in a slightly different way as:</p>
<div class="math notranslate nohighlight">
\[M_L = \log A(r) + \log r + C,\quad (8)\]</div>
<p>where <span class="math notranslate nohighlight">\(r\)</span> is the source-receiver hypocentral distance and <span class="math notranslate nohighlight">\(C\)</span> is a calibration constant. In Equation (8), attenuation is neglected. For small earthquakes and low noise seismograms, <span class="math notranslate nohighlight">\(M_L \propto \log M_0\)</span>.</p>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this heading"></a></h2>
<p>Aki, K., &amp; Richards, P. G. (2002). Quantitative seismology.</p>
<p>Boatwright, J. (1978). Detailed spectral analysis of two small New York State earthquakes. Bulletin of the Seismological Society of America, 68(4), 1117-1131.</p>
<p>Shearer, Peter M. Introduction to seismology. Cambridge university press, 2019.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># choose the number of threads you want to limit the computation to</span>
<span class="n">n_CPUs</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OMP_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n_CPUs</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">BPMF</span>
<span class="kn">import</span> <span class="nn">h5py</span> <span class="k">as</span> <span class="nn">h5</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">BPMF.data_reader_examples</span> <span class="kn">import</span> <span class="n">data_reader_mseed</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span> <span class="k">as</span> <span class="n">give_time</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">INPUT_DB_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;final_catalog.h5&quot;</span>
<span class="n">NETWORK_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;network.csv&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">net</span> <span class="o">=</span> <span class="n">BPMF</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">NETWORK_FILENAME</span><span class="p">)</span>
<span class="n">net</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Load-the-metadata-of-the-previously-detected-events">
<h2>Load the metadata of the previously detected events<a class="headerlink" href="#Load-the-metadata-of-the-previously-detected-events" title="Permalink to this heading"></a></h2>
<p>This is similar to what we did in 6_relocate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="n">h5</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BPMF</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">INPUT_DB_FILENAME</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">group_id</span> <span class="ow">in</span> <span class="n">fin</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">BPMF</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">read_from_file</span><span class="p">(</span>
                <span class="n">INPUT_DB_FILENAME</span><span class="p">,</span>
                <span class="n">db_path</span><span class="o">=</span><span class="n">BPMF</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">OUTPUT_PATH</span><span class="p">,</span>
                <span class="n">gid</span><span class="o">=</span><span class="n">group_id</span><span class="p">,</span>
                <span class="n">data_reader</span><span class="o">=</span><span class="n">data_reader_mseed</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># set the source-receiver distance as this is an important parameter</span>
        <span class="c1"># to know to correct for geometrical spreading</span>
        <span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_source_receiver_dist</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;arrival_times&quot;</span><span class="p">):</span>
            <span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_arrival_times_from_moveouts</span><span class="p">()</span>
        <span class="c1"># set the default moveouts to the theoretical times, that is, those computed in the velocity models</span>
        <span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_moveouts_to_theoretical_times</span><span class="p">()</span>
        <span class="c1"># when available, set the moveouts to the values defined by the empirical (PhaseNet) picks</span>
        <span class="n">events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_moveouts_to_empirical_times</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2"> events.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Make sure origin_time + moveout points at the phase arrival!
Loaded 66 events.
</pre></div></div>
</div>
</section>
<section id="Example-with-a-single-event">
<h2>Example with a single event<a class="headerlink" href="#Example-with-a-single-event" title="Permalink to this heading"></a></h2>
<p>In this section, we will demonstrate the workflow we adopt to compute the moment magnitude of each event. It consists in: - Extracting short windows around the P and S waves, as well as a noise window taken before the P wave. - Computing the velocity noise/P/S spectra on each channel. - Correcting for the path effects (geometrical spreading and attenuation). - Averaging the velocity over the network and integrating to get the displacement spectrum. - Fitting the displacement spectrum with a
model of our choice (here, the Boatwright model).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#         waveform extraction parameters</span>
<span class="c1"># PHASE_ON_COMP: dictionary defining which moveout we use to extract the waveform</span>
<span class="n">PHASE_ON_COMP_S</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">}</span>
<span class="n">PHASE_ON_COMP_P</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">}</span>
<span class="c1"># OFFSET_PHASE: dictionary defining the time offset taken before a given phase</span>
<span class="c1">#               for example OFFSET_PHASE[&quot;P&quot;] = 1.0 means that we extract the window</span>
<span class="c1">#               1 second before the predicted P arrival time</span>
<span class="n">OFFSET_PHASE</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
<span class="n">DURATION_SEC</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">OFFSET_OT_SEC_NOISE</span> <span class="o">=</span> <span class="n">DURATION_SEC</span> <span class="o">+</span> <span class="mf">1.0</span>
<span class="n">TIME_SHIFTED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">DATA_FOLDER</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span>
<span class="n">DATA_READER</span> <span class="o">=</span> <span class="n">data_reader_mseed</span>
<span class="n">ATTACH_RESPONSE</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1">#       spectral inversion parameters</span>
<span class="n">SPECTRAL_MODEL</span> <span class="o">=</span> <span class="s2">&quot;boatwright&quot;</span>
<span class="n">RHO_SOURCE_KGM3</span> <span class="o">=</span> <span class="mf">2700.0</span>
<span class="n">VS_SOURCE_MS</span> <span class="o">=</span> <span class="mf">3500.0</span>
<span class="n">VP_SOURCE_MS</span> <span class="o">=</span> <span class="n">VS_SOURCE_MS</span> <span class="o">*</span> <span class="mf">1.72</span>
<span class="n">RHO_RECEIVER_KGM3</span> <span class="o">=</span> <span class="mf">2600.0</span>
<span class="n">VS_RECEIVER_MS</span> <span class="o">=</span> <span class="mf">2800.0</span>
<span class="n">VP_RECEIVER_MS</span> <span class="o">=</span> <span class="n">VS_RECEIVER_MS</span> <span class="o">*</span> <span class="mf">1.72</span>
<span class="n">FREQ_MIN_HZ</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">FREQ_MAX_HZ</span> <span class="o">=</span> <span class="mf">20.</span>
<span class="n">NUM_FREQS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">SNR_THRESHOLD</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="n">MIN_NUM_VALID_CHANNELS_PER_FREQ_BIN</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">MIN_FRACTION_VALID_POINTS_BELOW_FC</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">MAX_RELATIVE_DISTANCE_ERR_PCT</span> <span class="o">=</span> <span class="mf">30.</span>
<span class="n">NUM_CHANNEL_WEIGHTED_FIT</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EVENT_IDX</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="n">EVENT_IDX</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>In the following, we define 3 <code class="docutils literal notranslate"><span class="pre">obspy.Stream</span></code> instances with the noise, P-wave and S-wave traces. Here, it is important to identify the clipped waveforms and set them to zero so that we don’t use them in the future. The identification of clipped waveforms is based on a simple kurtosis test (kurtosis is low for clipped waveforms because the extremum values are often reached).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#                 extract waveforms</span>
<span class="c1"># first, read short extract before signal as an estimate of noise</span>
<span class="n">event</span><span class="o">.</span><span class="n">read_waveforms</span><span class="p">(</span>
    <span class="n">DURATION_SEC</span><span class="p">,</span>
    <span class="n">time_shifted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">data_folder</span><span class="o">=</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
    <span class="n">offset_ot</span><span class="o">=</span><span class="n">OFFSET_OT_SEC_NOISE</span><span class="p">,</span>
    <span class="n">attach_response</span><span class="o">=</span><span class="n">ATTACH_RESPONSE</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">noise</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>

<span class="c1"># then, read signal</span>
<span class="n">event</span><span class="o">.</span><span class="n">read_waveforms</span><span class="p">(</span>
    <span class="n">DURATION_SEC</span><span class="p">,</span>
    <span class="n">phase_on_comp</span><span class="o">=</span><span class="n">PHASE_ON_COMP_P</span><span class="p">,</span>
    <span class="n">offset_phase</span><span class="o">=</span><span class="n">OFFSET_PHASE</span><span class="p">,</span>
    <span class="n">time_shifted</span><span class="o">=</span><span class="n">TIME_SHIFTED</span><span class="p">,</span>
    <span class="n">data_folder</span><span class="o">=</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
    <span class="n">attach_response</span><span class="o">=</span><span class="n">ATTACH_RESPONSE</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
<span class="n">event</span><span class="o">.</span><span class="n">zero_out_clipped_waveforms</span><span class="p">(</span><span class="n">kurtosis_threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p_wave</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">event</span><span class="o">.</span><span class="n">read_waveforms</span><span class="p">(</span>
    <span class="n">DURATION_SEC</span><span class="p">,</span>
    <span class="n">phase_on_comp</span><span class="o">=</span><span class="n">PHASE_ON_COMP_S</span><span class="p">,</span>
    <span class="n">offset_phase</span><span class="o">=</span><span class="n">OFFSET_PHASE</span><span class="p">,</span>
    <span class="n">time_shifted</span><span class="o">=</span><span class="n">TIME_SHIFTED</span><span class="p">,</span>
    <span class="n">data_folder</span><span class="o">=</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
    <span class="n">attach_response</span><span class="o">=</span><span class="n">ATTACH_RESPONSE</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
<span class="n">event</span><span class="o">.</span><span class="n">zero_out_clipped_waveforms</span><span class="p">(</span><span class="n">kurtosis_threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">s_wave</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<p>We can now compute the velocity spectra on each channel.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum</span> <span class="o">=</span> <span class="n">BPMF</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">compute_spectrum</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="s2">&quot;noise&quot;</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">compute_spectrum</span><span class="p">(</span><span class="n">p_wave</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">compute_spectrum</span><span class="p">(</span><span class="n">s_wave</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>

<span class="n">spectrum</span><span class="o">.</span><span class="n">set_target_frequencies</span><span class="p">(</span><span class="n">FREQ_MIN_HZ</span><span class="p">,</span> <span class="n">FREQ_MAX_HZ</span><span class="p">,</span> <span class="n">NUM_FREQS</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">phases</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">compute_signal_to_noise_ratio</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">compute_signal_to_noise_ratio</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>Let’s plot the velocity spectra and the signal-to-noise ratio (SNR) spectra.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phase_to_plot</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">plot_spectrum</span><span class="p">(</span><span class="n">phase_to_plot</span><span class="p">,</span> <span class="n">plot_snr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_14_0.png" src="../../_images/tutorial_notebooks_10_magnitudes_14_0.png" />
</div>
</div>
<p>Before correcting for geometrical spreading, we need to build an attenuation model. In general, body-wave attenuation in the lithosphere is described by he quality factor <span class="math notranslate nohighlight">\(Q\)</span>, which is related to frequency by (Aki, 1980):</p>
<div class="math notranslate nohighlight">
\[Q \propto f^{n},\ 0.5 \leq n \leq 0.8\quad (6)\]</div>
<p>To build a simple model of attenuation, we assume that <span class="math notranslate nohighlight">\(Q^P = Q^S = Q_0 f^n\)</span>. We search for an adequate value of <span class="math notranslate nohighlight">\(Q_0\)</span> and <span class="math notranslate nohighlight">\(n\)</span> in the literature. <span class="math notranslate nohighlight">\(Q_0 = 33\)</span> and <span class="math notranslate nohighlight">\(n = 0.75\)</span> reproduce reasonably well the curves shown in Izgi et al., 2020.</p>
<p>References:</p>
<p>Aki, K. (1980). Attenuation of shear-waves in the lithosphere for frequencies from 0.05 to 25 Hz. Physics of the Earth and Planetary Interiors, 21(1), 50-60.</p>
<p>Izgi, G., Eken, T., Gaebler, P., Eulenfeld, T., &amp; Taymaz, T. (2020). Crustal seismic attenuation parameters in the western region of the North Anatolian Fault Zone. Journal of Geodynamics, 134, 101694.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Q_1Hz</span> <span class="o">=</span> <span class="mf">33.</span>
<span class="n">n</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">Q_1Hz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum</span><span class="o">.</span><span class="n">attenuation_Q_model</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
<span class="n">spectrum</span><span class="o">.</span><span class="n">compute_correction_factor</span><span class="p">(</span>
    <span class="n">RHO_SOURCE_KGM3</span><span class="p">,</span> <span class="n">RHO_RECEIVER_KGM3</span><span class="p">,</span>
    <span class="n">VP_SOURCE_MS</span><span class="p">,</span> <span class="n">VP_RECEIVER_MS</span><span class="p">,</span>
    <span class="n">VS_SOURCE_MS</span><span class="p">,</span> <span class="n">VS_RECEIVER_MS</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_parameters</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">phase_for_mag</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">]:</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_network_average_spectrum</span><span class="p">(</span>
        <span class="n">phase_for_mag</span><span class="p">,</span>
        <span class="n">SNR_THRESHOLD</span><span class="p">,</span>
        <span class="n">min_num_valid_channels_per_freq_bin</span><span class="o">=</span><span class="n">MIN_NUM_VALID_CHANNELS_PER_FREQ_BIN</span><span class="p">,</span>
        <span class="n">max_relative_distance_err_pct</span><span class="o">=</span><span class="n">MAX_RELATIVE_DISTANCE_ERR_PCT</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">phase_for_mag</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">fit_average_spectrum</span><span class="p">(</span>
            <span class="n">phase_for_mag</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">SPECTRAL_MODEL</span><span class="p">,</span>
            <span class="n">min_fraction_valid_points_below_fc</span><span class="o">=</span><span class="n">MIN_FRACTION_VALID_POINTS_BELOW_FC</span><span class="p">,</span>
            <span class="n">weighted</span><span class="o">=</span><span class="n">NUM_CHANNEL_WEIGHTED_FIT</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">inversion_success</span><span class="p">:</span>
        <span class="n">rel_M0_err</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><span class="n">spectrum</span><span class="o">.</span><span class="n">M0_err</span><span class="o">/</span><span class="n">spectrum</span><span class="o">.</span><span class="n">M0</span>
        <span class="n">rel_fc_err</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><span class="n">spectrum</span><span class="o">.</span><span class="n">fc_err</span><span class="o">/</span><span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span>
        <span class="k">if</span> <span class="n">rel_M0_err</span> <span class="o">&gt;</span> <span class="mf">10.</span> <span class="ow">or</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span> <span class="o">&gt;</span> <span class="mf">25.</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative error on M0: </span><span class="si">{</span><span class="n">rel_M0_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative error on fc: </span><span class="si">{</span><span class="n">rel_fc_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="c1"># event.set_aux_data({f&quot;Mw_{phase_for_mag}&quot;: spectrum.Mw})</span>
        <span class="n">figtitle</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">origin_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">latitude</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;N, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">longitude</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;E, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">depth</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">km, &quot;</span>
                    <span class="sa">r</span><span class="s2">&quot;$\Delta M_0 / M_0=$&quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rel_M0_err</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, &quot;</span>
                    <span class="sa">r</span><span class="s2">&quot;$\Delta f_c / f_c=$&quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rel_fc_err</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">M0</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Mw_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">Mw</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fc_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_err_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">M0_err</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fc_err_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc_err</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">plot_average_spectrum</span><span class="p">(</span>
                <span class="n">phase_for_mag</span><span class="p">,</span>
                <span class="n">plot_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">figname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">_spectrum_</span><span class="si">{</span><span class="n">EVENT_IDX</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">figtitle</span><span class="o">=</span><span class="n">figtitle</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                <span class="n">plot_std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">plot_num_valid_channels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Relative error on M0: 4.50%
Relative error on fc: 2.92%
Relative error on M0: 4.25%
Relative error on fc: 2.87%
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_18_1.png" src="../../_images/tutorial_notebooks_10_magnitudes_18_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_18_2.png" src="../../_images/tutorial_notebooks_10_magnitudes_18_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum</span><span class="o">.</span><span class="n">average_s_spectrum</span><span class="p">[</span><span class="s2">&quot;num_valid_channels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dtype(&#39;int64&#39;)
</pre></div></div>
</div>
<p>To get a single final estimate of the moment magnitude <span class="math notranslate nohighlight">\(M_w\)</span>, we average the P- and S-wave estimates. Thus,</p>
<div class="math notranslate nohighlight">
\[M_w = \frac{1}{2} (M_w^P + M_w^S).\quad (7)\]</div>
<p>Using the definition of the moment magnitude, we can derive the following formula for the magnitude error:</p>
<div class="math notranslate nohighlight">
\[d M_w = \frac{1}{3} \left( \frac{dM_0^P}{M_0^P} + \frac{dM_0^S}{M_0^S} \right)\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Mw_exists</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">norm</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">Mw</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">Mw_err</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="k">for</span> <span class="n">ph</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;Mw_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">source_parameters</span><span class="p">:</span>
        <span class="n">Mw</span> <span class="o">+=</span> <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Mw_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">Mw_err</span> <span class="o">+=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_err_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="n">norm</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">Mw_exists</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">Mw_exists</span><span class="p">:</span>
    <span class="n">Mw</span> <span class="o">/=</span> <span class="n">norm</span>
    <span class="n">Mw_err</span> <span class="o">/=</span> <span class="n">norm</span>
    <span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw</span>
    <span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw_err</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">Mw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">Mw_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The P-S averaged moment magnitude is </span><span class="si">{</span><span class="n">Mw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">Mw_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw</span>
<span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw_err</span>
<span class="n">source_parameters</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The P-S averaged moment magnitude is 2.92 +/- 0.03
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;M0_p&#39;: 65474240448177.36,
 &#39;Mw_p&#39;: 3.144046979316432,
 &#39;fc_p&#39;: 6.279707551591183,
 &#39;M0_err_p&#39;: 2945820262566.399,
 &#39;fc_err_p&#39;: 0.18361036972659867,
 &#39;M0_s&#39;: 14302130194054.861,
 &#39;Mw_s&#39;: 2.703600484772714,
 &#39;fc_s&#39;: 6.504467728578857,
 &#39;M0_err_s&#39;: 608139228774.5485,
 &#39;fc_err_s&#39;: 0.1868668334493533,
 &#39;Mw&#39;: 2.923823732044573,
 &#39;Mw_err&#39;: 0.0291709780389873}
</pre></div></div>
</div>
</section>
<section id="Repeat-the-same-processing-for-every-event">
<h2>Repeat the same processing for every event<a class="headerlink" href="#Repeat-the-same-processing-for-every-event" title="Permalink to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#         waveform extraction parameters</span>
<span class="c1"># PHASE_ON_COMP: dictionary defining which moveout we use to extract the waveform</span>
<span class="n">PHASE_ON_COMP_S</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="s2">&quot;S&quot;</span><span class="p">}</span>
<span class="n">PHASE_ON_COMP_P</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">}</span>
<span class="c1"># OFFSET_PHASE: dictionary defining the time offset taken before a given phase</span>
<span class="c1">#               for example OFFSET_PHASE[&quot;P&quot;] = 1.0 means that we extract the window</span>
<span class="c1">#               1 second before the predicted P arrival time</span>
<span class="n">OFFSET_PHASE</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span>
<span class="n">DURATION_SEC</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">OFFSET_OT_SEC_NOISE</span> <span class="o">=</span> <span class="n">DURATION_SEC</span> <span class="o">+</span> <span class="mf">1.0</span>
<span class="n">TIME_SHIFTED</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">DATA_FOLDER</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span>
<span class="n">DATA_READER</span> <span class="o">=</span> <span class="n">data_reader_mseed</span>
<span class="n">ATTACH_RESPONSE</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1">#       spectral inversion parameters</span>
<span class="n">SPECTRAL_MODEL</span> <span class="o">=</span> <span class="s2">&quot;boatwright&quot;</span>
<span class="n">RHO_SOURCE_KGM3</span> <span class="o">=</span> <span class="mf">2700.0</span>
<span class="n">VS_SOURCE_MS</span> <span class="o">=</span> <span class="mf">3500.0</span>
<span class="n">VP_SOURCE_MS</span> <span class="o">=</span> <span class="n">VS_SOURCE_MS</span> <span class="o">*</span> <span class="mf">1.72</span>
<span class="n">RHO_RECEIVER_KGM3</span> <span class="o">=</span> <span class="mf">2600.0</span>
<span class="n">VS_RECEIVER_MS</span> <span class="o">=</span> <span class="mf">2800.0</span>
<span class="n">VP_RECEIVER_MS</span> <span class="o">=</span> <span class="n">VS_RECEIVER_MS</span> <span class="o">*</span> <span class="mf">1.72</span>
<span class="n">FREQ_MIN_HZ</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">FREQ_MAX_HZ</span> <span class="o">=</span> <span class="mf">20.</span>
<span class="n">NUM_FREQS</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">SNR_THRESHOLD</span> <span class="o">=</span> <span class="mf">10.</span>
<span class="n">MIN_NUM_VALID_CHANNELS_PER_FREQ_BIN</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">MIN_FRACTION_VALID_POINTS_BELOW_FC</span> <span class="o">=</span> <span class="mf">0.20</span>
<span class="n">MAX_RELATIVE_DISTANCE_ERR_PCT</span> <span class="o">=</span> <span class="mf">30.</span>
<span class="n">NUM_CHANNEL_WEIGHTED_FIT</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1">#                   attenuation model</span>
<span class="n">Q_1Hz</span> <span class="o">=</span> <span class="mf">33.</span>
<span class="n">n</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">Q_1Hz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing event </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#                 extract waveforms</span>
    <span class="c1"># first, read short extract before signal as an estimate of noise</span>
    <span class="n">event</span><span class="o">.</span><span class="n">read_waveforms</span><span class="p">(</span>
        <span class="n">DURATION_SEC</span><span class="p">,</span>
        <span class="n">time_shifted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">data_folder</span><span class="o">=</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
        <span class="n">offset_ot</span><span class="o">=</span><span class="n">OFFSET_OT_SEC_NOISE</span><span class="p">,</span>
        <span class="n">attach_response</span><span class="o">=</span><span class="n">ATTACH_RESPONSE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">noise</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>

    <span class="c1"># then, read signal</span>
    <span class="n">event</span><span class="o">.</span><span class="n">read_waveforms</span><span class="p">(</span>
        <span class="n">DURATION_SEC</span><span class="p">,</span>
        <span class="n">phase_on_comp</span><span class="o">=</span><span class="n">PHASE_ON_COMP_P</span><span class="p">,</span>
        <span class="n">offset_phase</span><span class="o">=</span><span class="n">OFFSET_PHASE</span><span class="p">,</span>
        <span class="n">time_shifted</span><span class="o">=</span><span class="n">TIME_SHIFTED</span><span class="p">,</span>
        <span class="n">data_folder</span><span class="o">=</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
        <span class="n">attach_response</span><span class="o">=</span><span class="n">ATTACH_RESPONSE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
    <span class="n">event</span><span class="o">.</span><span class="n">zero_out_clipped_waveforms</span><span class="p">(</span><span class="n">kurtosis_threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p_wave</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">event</span><span class="o">.</span><span class="n">read_waveforms</span><span class="p">(</span>
        <span class="n">DURATION_SEC</span><span class="p">,</span>
        <span class="n">phase_on_comp</span><span class="o">=</span><span class="n">PHASE_ON_COMP_S</span><span class="p">,</span>
        <span class="n">offset_phase</span><span class="o">=</span><span class="n">OFFSET_PHASE</span><span class="p">,</span>
        <span class="n">time_shifted</span><span class="o">=</span><span class="n">TIME_SHIFTED</span><span class="p">,</span>
        <span class="n">data_folder</span><span class="o">=</span><span class="n">DATA_FOLDER</span><span class="p">,</span>
        <span class="n">attach_response</span><span class="o">=</span><span class="n">ATTACH_RESPONSE</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">remove_sensitivity</span><span class="p">()</span>
    <span class="n">event</span><span class="o">.</span><span class="n">zero_out_clipped_waveforms</span><span class="p">(</span><span class="n">kurtosis_threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_wave</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">traces</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">BPMF</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">Spectrum</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">event</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_spectrum</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="s2">&quot;noise&quot;</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_spectrum</span><span class="p">(</span><span class="n">p_wave</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_spectrum</span><span class="p">(</span><span class="n">s_wave</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>

    <span class="n">spectrum</span><span class="o">.</span><span class="n">set_target_frequencies</span><span class="p">(</span><span class="n">FREQ_MIN_HZ</span><span class="p">,</span> <span class="n">FREQ_MAX_HZ</span><span class="p">,</span> <span class="n">NUM_FREQS</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">spectrum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">phases</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_signal_to_noise_ratio</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_signal_to_noise_ratio</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>

    <span class="n">spectrum</span><span class="o">.</span><span class="n">attenuation_Q_model</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
    <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_correction_factor</span><span class="p">(</span>
        <span class="n">RHO_SOURCE_KGM3</span><span class="p">,</span> <span class="n">RHO_RECEIVER_KGM3</span><span class="p">,</span>
        <span class="n">VP_SOURCE_MS</span><span class="p">,</span> <span class="n">VP_RECEIVER_MS</span><span class="p">,</span>
        <span class="n">VS_SOURCE_MS</span><span class="p">,</span> <span class="n">VS_RECEIVER_MS</span>
    <span class="p">)</span>

    <span class="n">source_parameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">phase_for_mag</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">]:</span>
        <span class="n">spectrum</span><span class="o">.</span><span class="n">compute_network_average_spectrum</span><span class="p">(</span>
            <span class="n">phase_for_mag</span><span class="p">,</span>
            <span class="n">SNR_THRESHOLD</span><span class="p">,</span>
            <span class="n">min_num_valid_channels_per_freq_bin</span><span class="o">=</span><span class="n">MIN_NUM_VALID_CHANNELS_PER_FREQ_BIN</span><span class="p">,</span>
            <span class="n">max_relative_distance_err_pct</span><span class="o">=</span><span class="n">MAX_RELATIVE_DISTANCE_ERR_PCT</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phase_for_mag</span> <span class="ow">in</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">average_spectra</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">spectrum</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">phase_for_mag</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">spectrum</span><span class="o">.</span><span class="n">fit_average_spectrum</span><span class="p">(</span>
                <span class="n">phase_for_mag</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">SPECTRAL_MODEL</span><span class="p">,</span>
                <span class="n">min_fraction_valid_points_below_fc</span><span class="o">=</span><span class="n">MIN_FRACTION_VALID_POINTS_BELOW_FC</span><span class="p">,</span>
                <span class="n">weighted</span><span class="o">=</span><span class="n">NUM_CHANNEL_WEIGHTED_FIT</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">inversion_success</span><span class="p">:</span>
            <span class="n">rel_M0_err</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><span class="n">spectrum</span><span class="o">.</span><span class="n">M0_err</span><span class="o">/</span><span class="n">spectrum</span><span class="o">.</span><span class="n">M0</span>
            <span class="n">rel_fc_err</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><span class="n">spectrum</span><span class="o">.</span><span class="n">fc_err</span><span class="o">/</span><span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span>
            <span class="k">if</span> <span class="n">rel_M0_err</span> <span class="o">&gt;</span> <span class="mf">10.</span> <span class="ow">or</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span> <span class="o">&gt;</span> <span class="mf">25.</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># event.set_aux_data({f&quot;Mw_{phase_for_mag}&quot;: spectrum.Mw})</span>
            <span class="n">figtitle</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">origin_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">latitude</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;N, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">longitude</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;E, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">depth</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">km, &quot;</span>
                        <span class="sa">r</span><span class="s2">&quot;$\Delta M_0 / M_0=$&quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rel_M0_err</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, &quot;</span>
                        <span class="sa">r</span><span class="s2">&quot;$\Delta f_c / f_c=$&quot;</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rel_fc_err</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
            <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">M0</span>
            <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Mw_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">Mw</span>
            <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fc_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc</span>
            <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_err_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">M0_err</span>
            <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;fc_err_</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">fc_err</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">plot_average_spectrum</span><span class="p">(</span>
                    <span class="n">phase_for_mag</span><span class="p">,</span>
                    <span class="n">plot_fit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">figname</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">phase_for_mag</span><span class="si">}</span><span class="s2">_spectrum_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">figtitle</span><span class="o">=</span><span class="n">figtitle</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                    <span class="n">plot_std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plot_num_valid_channels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="n">Mw_exists</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Mw</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Mw_err</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">ph</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;Mw_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">source_parameters</span><span class="p">:</span>
            <span class="n">Mw</span> <span class="o">+=</span> <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Mw_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">Mw_err</span> <span class="o">+=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span> <span class="o">*</span> <span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_err_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">source_parameters</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M0_</span><span class="si">{</span><span class="n">ph</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="n">norm</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">Mw_exists</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">Mw_exists</span><span class="p">:</span>
        <span class="n">Mw</span> <span class="o">/=</span> <span class="n">norm</span>
        <span class="n">Mw_err</span> <span class="o">/=</span> <span class="n">norm</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw</span>
        <span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw_err</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Mw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">Mw_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The P-S averaged moment magnitude is </span><span class="si">{</span><span class="n">Mw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">Mw_err</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw</span>
    <span class="n">source_parameters</span><span class="p">[</span><span class="s2">&quot;Mw_err&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mw_err</span>

    <span class="c1"># save all this new information in BPMF.dataset.Event.aux_data</span>
    <span class="n">event</span><span class="o">.</span><span class="n">set_aux_data</span><span class="p">(</span><span class="n">source_parameters</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
========================
Processing event 0
Not enough valid points! (Only 2.00%)
Not enough valid points! (Only 9.00%)
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 1
Not enough valid points! (Only 8.00%)
Not enough valid points! (Only 8.00%)
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 2
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 3
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 4
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 5
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 6
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 7
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 8
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 9
The P-S averaged moment magnitude is 2.87 +/- 0.03
========================
Processing event 10
The P-S averaged moment magnitude is 2.93 +/- 0.04
========================
Processing event 11
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 12
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 13
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 14
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 15
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 16
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 17
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 18
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 19
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 20
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 21
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 22
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 23
The P-S averaged moment magnitude is 2.91 +/- 0.03
========================
Processing event 24
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 25
Not enough valid points! (Only 48.00%)
The P-S averaged moment magnitude is 2.70 +/- 0.05
========================
Processing event 26
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 27
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 28
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 29
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 30
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 31
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 32
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 33
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 34
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 35
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 36
Not enough valid points! (Only 21.00%)
Not enough valid points! (Only 32.00%)
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 37
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 38
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 39
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 40
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 41
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 42
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 43
Spectrum is below SNR threshold everywhere, cannot fit it.
Spectrum is below SNR threshold everywhere, cannot fit it.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 44
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 45
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 46
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 47
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 48
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 49
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 50
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 51
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 52
Not enough valid points! (Only 20.00%)
Not enough valid points! (Only 30.00%)
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 53
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 54
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 55
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 56
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 57
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 58
Not enough valid points! (Only 41.00%)
Not enough valid points! (Only 42.00%)
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 59
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 60
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 61
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 62
Class instance does not have a `cov_mat` attribute.
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 63
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 64
The P-S averaged moment magnitude is nan +/- nan
========================
Processing event 65
The P-S averaged moment magnitude is nan +/- nan
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_1.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_2.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_3.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_4.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_5.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_6.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_6.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorial_notebooks_10_magnitudes_24_7.png" src="../../_images/tutorial_notebooks_10_magnitudes_24_7.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[71]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for event in backprojection_events:</span>
<span class="c1">#     event.update_aux_data_database()</span>
<span class="n">BPMF</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">donefun</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⠀⢀⡤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⡀⠀⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢀⡏⠀⠀⠈⠳⣄⠀⠀⠀⠀⠀⣀⠴⠋⠉⠉⡆⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠈⠉⠉⠙⠓⠚⠁⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀
    ⠀⠀⠀⠀⢀⠞⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⣄⠀⠀⠀⠀
    ⠀⠀⠀⠀⡞⠀⠀⠀⠀⠀⠶⠀⠀⠀⠀⠀⠀⠦⠀⠀⠀⠀⠀⠸⡆⠀⠀⠀
    ⢠⣤⣶⣾⣧⣤⣤⣀⡀⠀⠀⠀⠀⠈⠀⠀⠀⢀⡤⠴⠶⠤⢤⡀⣧⣀⣀⠀
    ⠻⠶⣾⠁⠀⠀⠀⠀⠙⣆⠀⠀⠀⠀⠀⠀⣰⠋⠀⠀⠀⠀⠀⢹⣿⣭⣽⠇
    ⠀⠀⠙⠤⠴⢤⡤⠤⠤⠋⠉⠉⠉⠉⠉⠉⠉⠳⠖⠦⠤⠶⠦⠞⠁⠀⠀⠀
                ALL DONE!⠀⠀⠀⠀

</pre></div></div>
</div>
</section>
<section id="To-be-continued…">
<h2>To be continued…<a class="headerlink" href="#To-be-continued…" title="Permalink to this heading"></a></h2>
<p>Work-in-progress!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="9_build_earthquake_catalog.html" class="btn btn-neutral float-left" title="Build Earthquake Catalog" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../updates.html" class="btn btn-neutral float-right" title="Updates" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Eric Beauce, William B. Frank.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>